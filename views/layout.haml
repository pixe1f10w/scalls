!!! 5
%html{ :lang => "ru" } 
  %head
    %meta{ :charset => "utf-8" }
    %title Учёт звонков
    %meta{ :content => "Статистика исходящих звонков диспетчеров", :name => "description" }
    %meta{ :content => "Ilia Zhirov", :name => "author" }
    /[if lt IE 9]
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    %link{ :rel => "stylesheet", :href => "#{@url}/assets/bootstrap.css" }
    %link{ :rel => "stylesheet", :href => "#{@url}/assets/style.css" }
    %link{ :rel => "stylesheet", :href => "#{@url}/assets/responsive.css" }

    %link{ :href => "#{@url}/assets/favicon.ico", :rel => "shortcut icon" }
    %link{ :href => "#{@url}/assets/apple-touch-icon.png", :rel => "apple-touch-icon" }
    %link{ :href => "#{@url}/assets/apple-touch-icon-72x72.png", :rel => "apple-touch-icon", :sizes => "72x72" }
    %link{ :href => "#{@url}/assets/apple-touch-icon-114x114.png", :rel => "apple-touch-icon", :sizes => "114x114" }
  %body
    = yield
    %script{ :src => "#{@url}/assets/jquery.js" }
    %script{ :src => "#{@url}/assets/spin.js" }
    %script{ :src => "#{@url}/assets/bootstrap-transition.js" }
    %script{ :src => "#{@url}/assets/bootstrap-alert.js" }
    %script{ :src => "#{@url}/assets/bootstrap-modal.js" }
    %script{ :src => "#{@url}/assets/bootstrap-dropdown.js" }
    %script{ :src => "#{@url}/assets/bootstrap-scrollspy.js" }
    %script{ :src => "#{@url}/assets/bootstrap-tab.js" }
    %script{ :src => "#{@url}/assets/bootstrap-tooltip.js" }
    %script{ :src => "#{@url}/assets/bootstrap-popover.js" }
    %script{ :src => "#{@url}/assets/bootstrap-button.js" }
    %script{ :src => "#{@url}/assets/bootstrap-collapse.js" }
    %script{ :src => "#{@url}/assets/bootstrap-carousel.js" }
    %script{ :src => "#{@url}/assets/bootstrap-typeahead.js" }
    %script{ :src => "#{@url}/assets/jquery.spin.js" }
    %script{ :src => "#{@url}/assets/jquery.fileDownload.js" }
    :javascript
      function spinup( callback ) {
        $('#export').spin('small');
        if ( callback && typeof callback == 'function' )
          callback();
      }
      
      $('#export').click( function() { 
        var disabled = $(this).attr('disabled');
        if ( !( typeof disabled !== 'undefined' && disabled !== false ) ) spinup( function() {
          $.fileDownload( $('#export').attr('href'), {
            successCallback : function( url ) { 
              $('#export').spin(false);
            }, 
            failCallback : function( url ) { 
              $('#export').spin(false);
              alert( 'Ошибка при выгрузке файла' ); 
            } 
          } );
        } );
      } );
      
